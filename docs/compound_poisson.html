<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.145">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Stochastic Processes with R - 1&nbsp; Compound Poisson Processes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./index.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Compound Poisson Processes</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Stochastic Processes with R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/speegled/stochastic/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Share" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-share"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
<li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
            <i class="bi bi-bi-twitter pe-1"></i>
          Twitter
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
            <i class="bi bi-bi-facebook pe-1"></i>
          Facebook
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=%7Curl%7C">
            <i class="bi bi-bi-linkedin pe-1"></i>
          LinkedIn
          </a>
        </li>
    </ul>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./compound_poisson.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Compound Poisson Processes</span></a>
  </div>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#modeling-a-compound-poisson-process" id="toc-modeling-a-compound-poisson-process" class="nav-link active" data-scroll-target="#modeling-a-compound-poisson-process"><span class="toc-section-number">1.1</span>  Modeling a Compound Poisson Process</a>
  <ul class="collapse">
<li><a href="#simulated-data" id="toc-simulated-data" class="nav-link" data-scroll-target="#simulated-data"><span class="toc-section-number">1.1.1</span>  Simulated data</a></li>
  <li><a href="#non-simulated-data" id="toc-non-simulated-data" class="nav-link" data-scroll-target="#non-simulated-data"><span class="toc-section-number">1.1.2</span>  Non-simulated data</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/speegled/stochastic/edit/master/compound_poisson.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="chap-cpp" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Compound Poisson Processes</span></span></h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header><p>In this chapter, we consider a stochastic process <span class="math inline">\(X(t)\)</span> which is not necessarily a counting process. We say <span class="math inline">\(X(t)\)</span> is a <em>compound Poisson process</em> if [ X(t) = _{i = 1}^{N(t)} Y_i ] where <span class="math inline">\(N(t)\)</span> is a Poisson process with rate <span class="math inline">\(\lambda\)</span> and <span class="math inline">\(Y_1, \ldots\)</span> are independent, identically distributed random variables, which are also independent of <span class="math inline">\(N(t)\)</span>.</p>
<div id="exm-compoundprocess1" class="theorem example">
<p><span class="theorem-title"><strong>Example 1.1 (BSC enterings) </strong></span>If you let <span class="math inline">\(X(t)\)</span> denote the number of people who enter Busch Student Center at or before time <span class="math inline">\(t\)</span>, then this may not be a Poisson process. If we count all of the people who enter as a group as entering at the same time, then we could possibly model it as a compound Poisson process, where the arrival times of groups is a Poisson process, and the number of people in the group is a separate random variable (that we would need to model).</p>
</div>
<p>Other examples given in the text include the number of people involved in car accidents at a certain intersection, the amount of money that visitors to a casino lose, and number of people entering a movie theater.</p>
<p>We can compute the mean and variance of a compound Poisson process as follows:</p>
<div id="thm-meanvariancecompoundprocess" class="theorem">
<p><span class="theorem-title"><strong>Theorem 1.1 (Mean and Variance of Compound Poisson Process) </strong></span>The mean <span class="math inline">\(E[X(t)] = \lambda t E[Y]\)</span> and the variance is <span class="math inline">\({\mathrm{Var}}(X(t)) = \lambda t E[Y^2]\)</span>.</p>
</div>
<p>Let’s look at a simulation of a compound Poisson process in order to check these results via an example. We assume that <span class="math inline">\(N(t)\)</span> is a Poisson process with rate 2, and <span class="math inline">\(Y_i\)</span> are iid uniform random variables on the interval <span class="math inline">\([0, 1]\)</span>. From Theorem <a href="#thm-meanvariancecompoundprocess">Theorem&nbsp;<span>1.1</span></a>, we see that [ E[X(3)] = 2 = 3 ] and [ {}(X(t)) = 3 _0^1 x^2, dx = 2 ] We check this via a simulation. Note that we don’t need to know <strong>when</strong> the events occur exactly, only how many of them there are before time <span class="math inline">\(t = 3\)</span>. That is given by <code>r</code>pois(1, 6)`, as below.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">num_events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">lambda</span> <span class="op">*</span> <span class="va">t</span><span class="op">)</span></span>
<span><span class="va">x_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">num_events</span><span class="op">)</span><span class="op">)</span> <span class="co">#if num_events == 0, then this gives 0, which is what we want</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That is how we simulate a single trial of the compound Poisson process. To do multiple trials, we put it inside of <code>replicate</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span><span class="op">(</span><span class="fl">10000</span>, <span class="op">{</span></span>
<span>  <span class="va">num_events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">lambda</span> <span class="op">*</span> <span class="va">t</span><span class="op">)</span></span>
<span>  <span class="va">x_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">num_events</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">sim_data</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.983913</code></pre>
</div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">sim_data</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.013984</code></pre>
</div>
</div>
<p>If you run the above code a few times, you will see that the mean and variance of the compound Poisson process are as predicted by Theorem <a href="#thm-meanvariancecompoundprocess">Theorem&nbsp;<span>1.1</span></a>.</p>
<section id="modeling-a-compound-poisson-process" class="level2" data-number="1.1"><h2 data-number="1.1" class="anchored" data-anchor-id="modeling-a-compound-poisson-process">
<span class="header-section-number">1.1</span> Modeling a Compound Poisson Process</h2>
<p>In this section, we are interested in the reverse problem: if we are given data, how do we estimate <span class="math inline">\(\lambda\)</span> and the distribution of <span class="math inline">\(Y_1, \ldots, Y_{N(t)}\)</span>? For our purposes, we will make some assumptions about what kind of random variable <span class="math inline">\(Y_1, \ldots, Y_n\)</span> are and then use a goodness-of-fit test to see whether it is a reasonable fit to the data.</p>
<p>We start by modeling data that we <strong>know</strong> the true generative process of. This is so that we can see that out technique is working. In the next example, we will apply our technique to data that we don’t know the true generative process for.</p>
<section id="simulated-data" class="level3" data-number="1.1.1"><h3 data-number="1.1.1" class="anchored" data-anchor-id="simulated-data">
<span class="header-section-number">1.1.1</span> Simulated data</h3>
<p>We assume that <span class="math inline">\(N(t)\)</span> is Poisson with rate 2, and that <span class="math inline">\(Y_1, \ldots, Y_{N(t)}\)</span> are iid <strong>zero-truncated</strong> Poisson random variables with rate 3. Let’s imagine that this is the number of people entering a movie theater. For our simulated data, we are going to assume that we have collected data from time 0 to time 4, and we noted the time of arrival and the number of We create our simulated data as follows. The arrival times <span class="math inline">\(S_1, \ldots, S_{N(t)}\)</span> say <strong>when</strong> the groups arrived to the theater, and the values <span class="math inline">\(Y_1, \ldots, Y_{N(t)}\)</span> say <strong>how many</strong> people were in each group. We use zero-truncated Poisson because we are assuming that each <span class="math inline">\(Y_i &gt; 0\)</span>.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="va">num_events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">lambda</span> <span class="op">*</span> <span class="va">t</span><span class="op">)</span></span>
<span><span class="va">time_of_events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">num_events</span>, <span class="fl">0</span>, <span class="va">t</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">num_in_family</span> <span class="op">&lt;-</span> <span class="fu">actuar</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/actuar/man/ZeroTruncatedPoisson.html">rztpois</a></span><span class="op">(</span><span class="va">num_events</span>, <span class="fl">3</span><span class="op">)</span> <span class="co">#sampling from zero-truncated</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>trial <span class="op">=</span> <span class="fl">1</span>,</span>
<span>           time <span class="op">=</span> <span class="va">time_of_events</span>,</span>
<span>           num_in_family <span class="op">=</span> <span class="va">num_in_family</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  trial      time num_in_family
1     1 0.4450966             4
2     1 0.9025954             3
3     1 1.4497908             2
4     1 1.5024359             3
5     1 2.4302417             4
6     1 2.9852284             2</code></pre>
</div>
</div>
<p>To create a large sample of this type, we use <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map_df</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_df</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">300</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">num_events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">lambda</span> <span class="op">*</span> <span class="va">t</span><span class="op">)</span></span>
<span>  <span class="va">time_of_events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">num_events</span>, <span class="fl">0</span>, <span class="va">t</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">num_in_family</span> <span class="op">&lt;-</span> <span class="fu">actuar</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/actuar/man/ZeroTruncatedPoisson.html">rztpois</a></span><span class="op">(</span><span class="va">num_events</span>, <span class="fl">3</span><span class="op">)</span> <span class="co">#sampling from zero-truncated</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>trial <span class="op">=</span> <span class="va">x</span>,</span>
<span>             time <span class="op">=</span> <span class="va">time_of_events</span>,</span>
<span>             num_in_family <span class="op">=</span> <span class="va">num_in_family</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>First things first, let’s check whether every trial had at least one family arrive:</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">sim_data</span><span class="op">$</span><span class="va">trial</span><span class="op">)</span><span class="op">)</span> <span class="co">#yep!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 300</code></pre>
</div>
</div>
<p>In order to estimate the rate of the Poisson process <span class="math inline">\(N(t)\)</span>, we recall that the expected value of <span class="math inline">\(N(4)\)</span> is <span class="math inline">\(4\lambda\)</span>. We can estimate <span class="math inline">\(E[N(4)]\)</span> from the data by counting the total number of occurrences by time 4, and dividing by the total number of trials. In other words,</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">sim_data</span><span class="op">)</span><span class="op">/</span><span class="fl">300</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7.88</code></pre>
</div>
</div>
<p>Our estimate for trhe mean of <span class="math inline">\(N(4)\)</span> is 7.88, so our estimate for <span class="math inline">\(\lambda\)</span> is our previous estimate divided by 4; namely, 1.97. You should compare that to the true value of 2.</p>
<p>Now we turn to estimating the mean of the truncated Poisson process. The method of moments estimator for <span class="math inline">\(\lambda\)</span>, is given by [ = ] where <span class="math inline">\(\overline{x}\)</span> is the sample mean. We compute the sample mean as follows:</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">sim_data</span><span class="op">$</span><span class="va">num_in_family</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.136633</code></pre>
</div>
</div>
<p>and to solve for <span class="math inline">\(\hat \lambda\)</span>, well, that is a bit tricky, but we already know it is 3. Let’s just check:</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fl">3</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.157187</code></pre>
</div>
</div>
<p>Pretty good. If we want to solve for <span class="math inline">\(\hat \lambda\)</span>, we can use <code>optimize</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/optimize.html">optimize</a></span><span class="op">(</span>f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span> <span class="op">{</span><span class="op">(</span><span class="va">lambda</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">lambda</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">sim_data</span><span class="op">$</span><span class="va">num_in_family</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">}</span>,</span>
<span>         interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$minimum
[1] 2.976806

$objective
[1] 2.212965e-12</code></pre>
</div>
</div>
<p>Our estimate <span class="math inline">\(\hat \lambda\)</span> is given by the value in <code>$minimum</code>. We can also check via a plot that it is about <span class="math inline">\(\hat \lambda = 3\)</span>.</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html">curve</a></span><span class="op">(</span><span class="va">x</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, from <span class="op">=</span> <span class="fl">0</span>, to <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">sim_data</span><span class="op">$</span><span class="va">num_in_family</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">3</span>, lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="compound_poisson_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section><section id="non-simulated-data" class="level3" data-number="1.1.2"><h3 data-number="1.1.2" class="anchored" data-anchor-id="non-simulated-data">
<span class="header-section-number">1.1.2</span> Non-simulated data</h3>
<p>We consider the airplane crash data from <a href="https://www.kaggle.com/datasets/thedevastator/airplane-crashes-and-fatalities">Kaggle</a>. I imagine that airplane crashes are <strong>not</strong> a homogeneous Poisson process over the time frame of this data set (1908-present), because, well, that would just be too much to believe! Safety has improved (surely) but also the number of flights has increased, so it is not at all clear what to make of it. We’ll probably need to restrict down to a time interval where the rate of crashes is approximately constant.</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/airplane_crashes.csv"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">dd</span><span class="op">)</span></span>
<span><span class="va">dd</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5,268 × 14
   index date      time  locat…¹ opera…² flight route type  regis…³ cn_in aboard
   &lt;int&gt; &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;dbl&gt;
 1     0 09/17/19… "17:… Fort M… Milita… ""     "Dem… Wrig… ""      "1"        2
 2     1 07/12/19… "06:… Atlant… Milita… ""     "Tes… Diri… ""      ""         5
 3     2 08/06/19… ""    Victor… Private "-"    ""    Curt… ""      ""         1
 4     3 09/09/19… "18:… Over t… Milita… ""     ""    Zepp… ""      ""        20
 5     4 10/17/19… "10:… Near J… Milita… ""     ""    Zepp… ""      ""        30
 6     5 03/05/19… "01:… Tienen… Milita… ""     ""    Zepp… ""      ""        41
 7     6 09/03/19… "15:… Off Cu… Milita… ""     ""    Zepp… ""      ""        19
 8     7 07/28/19… ""    Near J… Milita… ""     ""    Schu… ""      ""        20
 9     8 09/24/19… "01:… Biller… Milita… ""     ""    Zepp… ""      ""        22
10     9 10/01/19… "23:… Potter… Milita… ""     ""    Zepp… ""      ""        19
# … with 5,258 more rows, 3 more variables: fatalities &lt;dbl&gt;, ground &lt;dbl&gt;,
#   summary &lt;chr&gt;, and abbreviated variable names ¹​location, ²​operator,
#   ³​registration</code></pre>
</div>
</div>
<p>The first thing I want to do is create a single date/time variable that encodes the time of the crash. To do so, we use the R package <code>lubridate</code>. If a crash doesn’t have an associated time, we just assume it happened at noon. I don’t think that will make a difference, but we will need to make sure our bins are not too small, in which case it would make a difference. Alternatively, I could’ve deleted those, but that seems like a lot of data to delete (42 percent!). One stil fails to parse (index 3267) because there is a typo in the time (114:20). Let’s assume they meant 14:20.</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dd</span><span class="op">$</span><span class="va">time</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4212225</code></pre>
</div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dd</span> <span class="op">&lt;-</span> <span class="va">dd</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">time</span> <span class="op">==</span> <span class="st">""</span>, <span class="st">"12:00"</span>, <span class="va">time</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">time</span> <span class="op">==</span> <span class="st">"114:20"</span>, <span class="st">"14:20"</span>, <span class="va">time</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>date_time <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">mdy_hm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">time</span>, sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>OK, now let’s get a histogram of the number of <strong>accidents</strong> over time.</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dd</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="compound_poisson_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can see that this is almost surely not a homogeneous Poisson process, but if we restrict to, say, 1990-2000 it might be. Let’s check it out.</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">aa</span> <span class="op">&lt;-</span> <span class="va">dd</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">date_time</span> <span class="op">&gt;</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">mdy</a></span><span class="op">(</span><span class="st">"12/31/1989"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">date_time</span> <span class="op">&lt;</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">mdy</a></span><span class="op">(</span><span class="st">"1/1/2001"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">aa</span><span class="op">$</span><span class="va">date_time</span>, breaks <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="compound_poisson_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>When creating histograms, R sometimes tries to guess what the natural range of values is based on the observed range of values. For example, in this case, the histogram bins range from to 980000000, where the actual range of values (in seconds) is 6.312876^{8} to 9.765459^{8}. So, the first and the last bins are different sizes than the rest, and should have different probabilities associated with them. The histogram also <strong>changes</strong> the number of breaks to make a better looking plot. In this case, it made 36 bins!</p>
<div class="callout-tryit callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tryit
</div>
</div>
<div class="callout-body-container callout-body">
<p>Confirm that a histogram using <code>hist(aa$date_time, breaks = 30)</code> has 36 bins. (It is the length of the counts variable that <code>hist</code> creates.) Confirm the values of the min and max break in the previous paragraph.</p>
</div>
</div>
<p>To fix this, we provide explicit locations of breaks, in terms of seconds.</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mindt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">aa</span><span class="op">$</span><span class="va">date_time</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">maxdt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">aa</span><span class="op">$</span><span class="va">date_time</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">aa</span><span class="op">$</span><span class="va">date_time</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">mindt</span> <span class="op">-</span> <span class="fl">1</span>, <span class="va">maxdt</span> <span class="op">+</span> <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">37</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="compound_poisson_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This histogram looks quite different, even though it is the same number of breaks as the previous histogram.</p>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let’s check to see whether this passes a goodness-of-fit test for a homogeneous Poisson process. We estimate the rate in terms of accidents per year. Note that there are 11 years in the data. We need to be really careful with units here! The units in <code>breaks</code> are <strong>seconds</strong> and we computed the rate in terms of <strong>years</strong>! We also need to check the number of bins that <code>hist</code> makes; just because you tell it to do 30, for example, doesn’t mean that there will be <strong>exactly</strong> 30 bins!!</p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rate</span> <span class="op">&lt;-</span> <span class="fl">851</span><span class="op">/</span><span class="fl">11</span> <span class="co">#rate in accidents per year</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now compute the expected and the observed number of accidents in each bin based on our estimate of the rate being <code>round(rate, 2)</code>. The variable <code>ss$counts</code> contains the observed values in the bins, so we just need to compute the expected value. There are roughly 31557600 seconds in a year, so we divide the rate in accidents per year by that number to get accidents per second.</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">observed_accidents</span> <span class="op">&lt;-</span> <span class="va">ss</span><span class="op">$</span><span class="va">counts</span></span>
<span><span class="va">expected_accidents</span> <span class="op">&lt;-</span> <span class="va">rate</span> <span class="op">*</span> <span class="op">(</span><span class="va">ss</span><span class="op">$</span><span class="va">breaks</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">ss</span><span class="op">$</span><span class="va">breaks</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="fl">31557600</span> </span>
<span><span class="va">test_stat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">observed_accidents</span> <span class="op">-</span> <span class="va">expected_accidents</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="va">expected_accidents</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">pchisq</a></span><span class="op">(</span><span class="va">test_stat</span>, df <span class="op">=</span> <span class="fl">35</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fl">1</span>, lower.tail <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3544935</code></pre>
</div>
</div>
<p>We fail to reject that airplane crashes are a homogeneous Poisson process. Let’s continue now with <strong>fatalities</strong>. That is surely not a homogeneous Poisson process, because it violates the assumption that multiple occurrences cannot happen at the same time. Let’s see what the distribution of fatalities looks like.</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">aa</span><span class="op">$</span><span class="va">fatalities</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="compound_poisson_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>It is really right skew. Maybe Poisson? No, for Poisson the mean is equal to the variance and check out our data!</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">aa</span><span class="op">$</span><span class="va">fatalities</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 21.54353</code></pre>
</div>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">aa</span><span class="op">$</span><span class="va">fatalities</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1454.524</code></pre>
</div>
</div>
<p>Many times when modeling a discrete rv with variance larger than the mean, we use <strong>negative binomial</strong> random variables. We choose the <code>size</code> and <code>mu</code> parameter to match the mean and variance of our data.</p>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/NegBinomial.html">rnbinom</a></span><span class="op">(</span><span class="fl">851</span>, size <span class="op">=</span> <span class="fl">.33</span>, mu <span class="op">=</span> <span class="fl">21</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="compound_poisson_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>This cannot be correct! Negative binomial random variables usually can take on zero with high probability, while the number of fatalities in the plane crashes we observed were almost never zero. In subsequent notes, we will use a <strong>zero truncated</strong> negative binomial random variable, which also will not be a good fit, but at least it has a chance.</p>
</div>
</div>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Preface</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->



</body></html>